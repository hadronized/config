# Options, highlighters, etc.
colorscheme catppuccin_macchiato

# add-highlighter global/ number-lines -hlcursor

# Commands

## Some pickers
define-command -hidden open_buffer_picker %{
  prompt buffer: -menu -buffer-completion %{
    buffer %val{text}
  }
}

define-command -hidden open_file_picker %{
  prompt file: -menu -shell-script-candidates 'fd --hidden --type=file' %{
    edit -existing %val{text}
  }
}

# LSP

eval %sh{kak-lsp --kakoune -s $kak_session}
hook global WinSetOption filetype=(rust|python|go|javascript|typescript|c|cpp) %{
  lsp-enable-window

    # Enable inlay diagnostics
    lsp-inlay-diagnostics-enable window

    # Enable inlay hints
    lsp-inlay-diagnostics-enable window
}

# Enable semantic tokens
hook global WinSetOption filetype=<language> %{
  hook window -group semantic-tokens BufReload .* lsp-semantic-tokens
  hook window -group semantic-tokens NormalIdle .* lsp-semantic-tokens
  hook window -group semantic-tokens InsertIdle .* lsp-semantic-tokens
  hook -once -always window WinSetOption filetype=.* %{
      remove-hooks window semantic-tokens
  }
}

# keybindings

## bépo remapping
map global normal c h # left
map global normal t j # down
map global normal s k # up
map global normal r l # right
map global normal C H # extend left
map global normal T J # extend down
map global normal S K # extend up
map global normal R L # extend right
map global normal h t # until
map global normal j r # replace
map global normal k s # select
map global normal l c # change
map global normal H T # extend to next char
map global normal J R # replace with yanked
map global normal K S # split
map global normal L C # duplicate selection downwards
map global insert ' ' ' '
map -docstring "line begin" global goto c h
map -docstring "buffer bottom" global goto t j
map -docstring "buffer top" global goto s k
map -docstring "line end" global goto r l
map -docstring "scroll left" global view c h
map -docstring "scroll up" global view t j
map -docstring "scroll down" global view s k
map -docstring "scroll right" global view r l

## alt remapping
map global normal m <a-i>       # select inner
map global normal M <a-a>       # select outer

## pickers
map global user b ':open_buffer_picker<ret>' -docstring "Open buffer picker"
map global user f ':open_file_picker<ret>'   -docstring "Open file picker"
